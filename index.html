<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grade My Finance | Free Financial Grade Calculator</title>
<meta name="description" content="Get a free financial health grade in seconds. Enter your income, expenses, and assets to see your money score and ways to improve. No sign-up required.">
<meta name="theme-color" content="#0f172a">
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<style>
:root{
  --bg:#0f172a; --panel:#0b1226; --card:#0b1226; --text:#e2e8f0; --muted:#94a3b8; --line:rgba(148,163,184,.22);
  --accent:#22d3ee; --accent2:#a78bfa; --g1:#16a34a; --g2:#34d399; --header-h:96px; --shadow:0 14px 40px rgba(0,0,0,.35);
}
@media (max-width:720px){ :root{ --header-h:74px } }
:root[data-theme="light"]{
  --bg:#f7fafc; --panel:#ffffff; --card:#ffffff; --text:#0b1226; --muted:#4b5563; --line:rgba(15,23,42,.12);
}
*{box-sizing:border-box}
html,body{width:100%}
body{
  margin:0; padding-top:var(--header-h); overflow-x:hidden;
  background:
    radial-gradient(900px 460px at -10% -10%, rgba(34,211,238,.18), transparent 50%),
    radial-gradient(900px 460px at 120% -10%, rgba(167,139,250,.15), transparent 55%),
    var(--bg);
  color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial; line-height:1.35;
}
.container{max-width:1100px;margin:0 auto;padding:0 16px}

/* Header */
header{ position:fixed; left:0; right:0; top:0; z-index:20; height:var(--header-h);
  display:grid; place-items:center;
  background:linear-gradient(90deg,var(--accent),var(--accent2)); border-bottom:1px solid var(--line);
}
.hdr{height:100%; display:flex; align-items:center; gap:12px; position:relative}
.logo{height:72px}
@media (max-width:720px){ .logo{height:58px} }
.brand{font-weight:900; font-size:22px; color:#062c1b}

/* true top-right toolbar */
.header-right{position:absolute; right:12px; top:10px; display:flex; gap:8px; align-items:center}
.btn{padding:12px 16px;border-radius:12px;border:1px solid var(--line);
  background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
  color:var(--text);font-weight:900;cursor:pointer;min-width:140px;transition:transform .15s ease, filter .15s ease}
.btn:hover{filter:brightness(1.06)} .btn:active{transform:translateY(1px)}
.btn.primary{background:linear-gradient(90deg,var(--g1),var(--g2));border-color:transparent;color:#062c1b}
.btn.mini{min-width:0;padding:6px 10px;font-weight:800} select.btn{appearance:none}
.btn:focus{outline:3px solid rgba(34,211,238,.35)}

/* Hero */
.hero{ display:flex; flex-direction:column; align-items:center; gap:10px; padding:14px 0 4px; text-align:center; }
.hero-card{ width:min(760px,92vw); background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
  border:1px solid var(--line); border-radius:22px; padding:18px; box-shadow:var(--shadow); }
.hero-title{margin:0 0 6px;font-size:30px;font-weight:900}
.hero-tag{margin:0 0 8px;color:var(--muted)}
.hero-cta{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

/* Layout */
.shell{max-width:1100px;margin:0 auto;padding:0 16px 22px}
.card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:14px;box-shadow:var(--shadow)}
.section-label{font-size:14px;margin:0 0 8px;color:var(--muted);font-weight:800;display:block}

.inputs{display:grid;grid-template-columns:repeat(4,minmax(220px,1fr));gap:14px}
@media (max-width:1060px){ .inputs{grid-template-columns:repeat(2,minmax(220px,1fr))} }
@media (max-width:720px){ .inputs{grid-template-columns:1fr; gap:12px} }

input{width:100%;border:1px solid var(--line);border-radius:12px;padding:12px;background:#0b1226;color:var(--text)}
:root[data-theme="light"] input{background:#fff}
input:focus{outline:none;border-color:#22d3ee;box-shadow:0 0 0 3px rgba(34,211,238,.30)}

.progress{height:12px;background:#0b1226;border:1px solid var(--line);border-radius:999px;overflow:hidden}
:root[data-theme="light"] .progress{background:#fff}
.progress>div{height:100%;width:0%;background:linear-gradient(90deg,var(--g1),var(--g2));transition:width .6s cubic-bezier(.2,.9,.2,1)}

/* Mascot (Grady) */
.mascot{display:grid;place-items:center;position:relative; margin-top:2px}
@keyframes floatCard{0%,100%{transform:translateY(0) rotate(-1.2deg)}50%{transform:translateY(-7px) rotate(1.2deg)}}
.floatA{position:absolute; right:8px; bottom:0; transform:translate(20%,30%); background:linear-gradient(180deg,#34d399,#16a34a); color:#062c1b; border:2px solid #86efac; border-radius:999px; font-weight:900; width:56px; height:56px; display:grid; place-items:center; box-shadow:0 10px 20px rgba(0,0,0,.45)}

/* Overlay & modal */
.overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.45);z-index:80}
.overlay.show{display:grid}
.loader{width:420px;max-width:92vw;background:var(--panel);border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:var(--shadow)}

.modal{position:fixed; inset:0; display:none; z-index:100; background:rgba(0,0,0,.55); backdrop-filter:blur(2px) }
.modal.show{display:grid; place-items:center}
.sheet{width:min(920px,94vw); max-height:88vh; overflow:auto; background:var(--panel); border:1px solid var(--line); border-radius:22px; box-shadow:var(--shadow); padding:18px; margin:10px;}
.sheet-header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px;}
.xbtn{background:#19223d;border:1px solid var(--line); color:#e2e8f0; border-radius:10px; padding:8px 12px; cursor:pointer}
.rc-top{display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px}
.rc-mascot{width:54px; height:54px; border-radius:14px; background:linear-gradient(180deg,#eafff3,#c8ffe3); border:2px solid #86EFAC; display:grid; place-items:center;}
.rc-title{font-weight:900; font-size:22px}
.rc-meta{color:#9fb0c7; font-size:14px}
.rc-grade{font-size:56px;font-weight:1000; border-radius:16px; padding:6px 16px; border:2px solid transparent}
.rc-grade.good{color:#062c1b; background:linear-gradient(180deg,#34d399,#16a34a); border-color:#86efac}
.rc-grade.mid{color:#062c1b; background:linear-gradient(180deg,#facc15,#f59e0b); border-color:#fde68a}
.rc-grade.bad{color:#fff; background:#ef4444; border-color:#fecaca}
.rc-head{display:grid; grid-template-columns: 1.2fr 1fr auto; gap:8px; color:#9fb0c7; font-weight:800; font-size:12px; margin-top:6px}
.rc-rows{display:grid; gap:8px; margin-top:6px}
.rc-row{display:grid; grid-template-columns: 1.2fr 1fr auto; gap:8px; align-items:center; background:rgba(255,255,255,.03); border:1px solid var(--line); border-radius:12px; padding:10px;}
.badge{font-weight:900; border:1px solid var(--line); border-radius:10px; padding:6px 10px; text-align:center; display:inline-block}
.badge.good{color:#062c1b;background:linear-gradient(180deg,#34d399,#16a34a); border-color:#86efac}
.badge.mid{color:#062c1b;background:linear-gradient(180deg,#facc15,#f59e0b)}
.badge.bad{color:#fff;background:#ef4444}

/* Footer + sticky CTA */
footer{background:#0b1226; border-top:1px solid var(--line); margin-top:22px; padding:22px 16px; color:#cbd5e1; font-size:14px}
:root[data-theme="light"] footer{background:#ffffff}
.fwrap{max-width:1000px; margin:0 auto; display:flex; flex-direction:column; align-items:center; gap:8px}
.fcontact{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:center}
.pill{padding:8px 12px; border:1px solid var(--line); border-radius:999px; background:rgba(255,255,255,.03); color:#3fb7ff}
.mobile-cta{position:fixed;left:0;right:0;bottom:0;padding:10px;background:rgba(15,23,42,.86); backdrop-filter:blur(8px);border-top:1px solid rgba(148,163,184,.22);display:none;z-index:90}
:root[data-theme="light"] .mobile-cta{background:rgba(255,255,255,.94)}
.mobile-cta.on{display:block}

svg, img { display:block; max-width:100%; height:auto; }
@media (max-width:720px){ .hero-card{ padding:14px } .inputs{ gap:10px } .card{ padding:12px } }
</style>
</head>
<body>

<header>
  <div class="hdr">
    <!-- Logo -->
    <svg class="logo" viewBox="0 0 220 120" xmlns="http://www.w3.org/2000/svg" aria-label="GMF logo">
      <defs>
        <radialGradient id="gSphere" cx="50%" cy="40%" r="70%"><stop offset="0" stop-color="#b9f4d1"/><stop offset=".55" stop-color="#34d399"/><stop offset="1" stop-color="#128a3f"/></radialGradient>
        <linearGradient id="paper" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="#ffffff"/><stop offset="1" stop-color="#e8ffe9"/></linearGradient>
      </defs>
      <g transform="translate(20,14)">
        <circle cx="40" cy="45" r="38" fill="url(#gSphere)"/>
        <circle cx="40" cy="45" r="38" fill="none" stroke="rgba(255,255,255,.35)" stroke-width="2"/>
        <text x="40" y="58" text-anchor="middle" font-size="44" font-weight="1000" fill="#072b19" stroke="#eafff3" stroke-width="1.6" paint-order="stroke">G</text>
      </g>
      <g transform="translate(110,10) rotate(-9)">
        <rect width="70" height="94" rx="12" fill="url(#paper)" stroke="#86EFAC" stroke-width="2"/>
        <g stroke="#10B981" stroke-width="2"><line x1="12" y1="28" x2="58" y2="28"/><line x1="12" y1="42" x2="58" y2="42"/><line x1="12" y1="56" x2="58" y2="56"/></g>
        <text x="35" y="76" text-anchor="middle" font-size="24" font-weight="900" fill="#ef4444">A+</text>
      </g>
    </svg>
    <div class="brand">Grade My Finance</div>
  </div>

  <!-- Top-right toolbar -->
  <div class="header-right">
    <select id="currencySel" class="btn mini" aria-label="Currency">
      <option>USD</option><option>EUR</option><option>GBP</option><option>CAD</option><option>AUD</option>
    </select>
    <button id="themeToggle" class="btn mini" type="button" aria-label="Toggle theme">üåô/‚òÄÔ∏è</button>
  </div>
</header>

<section class="container hero">
  <div class="hero-card">
    <h1 class="hero-title">Get your free money grade in seconds</h1>
    <p class="hero-tag">No sign-up. Plug in numbers ‚Üí get a score. Simple and effective.</p>
    <div class="hero-cta">
      <button class="btn" id="demoBtn" type="button">Try Demo</button>
      <button class="btn primary" id="gradeBtnTop" type="button">Get My Report Card</button>
      <button class="btn" id="copyLink" type="button">Copy share link</button>
    </div>
  </div>

  <div class="mascot">
    <!-- Grady -->
    <svg viewBox="0 0 280 260" width="240" aria-hidden="true" style="animation:floatCard 3s ease-in-out infinite">
      <defs><linearGradient id="mc" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="#E8FFF2"/><stop offset="1" stop-color="#CFFDE7"/></linearGradient></defs>
      <ellipse cx="140" cy="238" rx="60" ry="14" fill="rgba(0,0,0,.28)"/>
      <rect x="56" y="44" width="168" height="168" rx="28" fill="url(#mc)" stroke="#86EFAC" stroke-width="3"/>
      <circle cx="110" cy="104" r="8" fill="#0f172a"/><circle cx="170" cy="104" r="8" fill="#0f172a"/>
      <path d="M114 130 q26 22 52 0" stroke="#16a34a" stroke-width="6" fill="none" stroke-linecap="round"/>
      <g stroke="#a7f3d0" stroke-width="2">
        <line x1="84" y1="154" x2="196" y2="154"/><line x1="84" y1="170" x2="196" y2="170"/><line x1="84" y1="186" x2="196" y2="186"/>
      </g>
      <g transform="translate(190,140) rotate(-10)">
        <rect x="-2" y="-2" width="60" height="46" rx="8" fill="#ffffff" stroke="#86EFAC" stroke-width="2"/>
        <text x="28" y="30" text-anchor="middle" font-size="18" font-weight="900" fill="#ef4444">A+</text>
      </g>
    </svg>
    <div class="floatA" aria-hidden="true">A+</div>
  </div>
</section>

<!-- Inputs -->
<div class="shell">
  <main>
    <section id="grade" class="page active">
      <div class="inputs">
        <!-- Housing mode -->
        <div class="card" style="grid-column:1/-1;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <span class="section-label" style="margin:0">Housing</span>
          <button id="modeOwner" class="btn" type="button">Owner</button>
          <button id="modeRenter" class="btn" type="button">Renter</button>
        </div>

        <div class="card"><label class="section-label" for="income">Monthly Income (after-tax)</label><input id="income" type="number" value="0" min="0"></div>
        <div class="card"><label class="section-label" for="expenses">Monthly Expenses</label><input id="expenses" type="number" value="0" min="0"></div>
        <div class="card"><label class="section-label" for="age">Age</label><input id="age" type="number" value="30" min="16" max="100"></div>
        <div class="card" id="homeCard"><label class="section-label" for="home">Home Value</label><input id="home" type="number" value="0" min="0"><div class="section-label" id="assetsHint" style="margin-top:6px">Total Assets: ‚Äî</div></div>

        <div class="card"><label class="section-label" for="retire">Retirement (401k/IRA)</label><input id="retire" type="number" value="0" min="0"></div>
        <div class="card"><label class="section-label" for="brokerage">Brokerage / Stocks</label><input id="brokerage" type="number" value="0" min="0"></div>
        <div class="card"><label class="section-label" for="hsa">HSA</label><input id="hsa" type="number" value="0" min="0"></div>
        <div class="card"><label class="section-label" for="cash">Cash Savings</label><input id="cash" type="number" value="0" min="0"></div>

        <div class="card"><label class="section-label" for="car">Car Value</label><input id="car" type="number" value="0" min="0"></div>
        <div class="card" id="mortCard"><label class="section-label" for="mortgage">Mortgage Balance</label><input id="mortgage" type="number" value="0" min="0"><div class="section-label" id="liabHint" style="margin-top:6px">Total Liabilities: ‚Äî</div></div>
        <div class="card"><label class="section-label" for="student">Student Loans</label><input id="student" type="number" value="0" min="0"></div>
        <div class="card"><label class="section-label" for="auto">Auto Loans</label><input id="auto" type="number" value="0" min="0"></div>

        <div class="card"><label class="section-label" for="cc">Credit Cards (balance)</label><input id="cc" type="number" value="0" min="0"></div>

        <div class="card" style="grid-column:1/-1">
          <div style="display:flex;gap:8px;justify-content:space-between;align-items:center;flex-wrap:wrap">
            <button id="resetBtn" class="btn" type="button">Reset</button>
            <button id="gradeBtn" class="btn primary" type="button">Get My Report Card</button>
          </div>
          <div class="progress" style="margin:10px 0"><div id="progressFill"></div></div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Loader -->
<div id="overlay" class="overlay"><div class="loader"><strong>Crunching numbers‚Ä¶</strong></div></div>

<!-- Report Modal -->
<div id="reportModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="rcTitle">
  <div class="sheet">
    <div class="sheet-header">
      <div class="rc-top">
        <div class="rc-mascot" aria-hidden="true">
          <svg viewBox="0 0 64 64" width="38" height="38">
            <rect x="6" y="6" width="52" height="52" rx="12" fill="#eafff3"/>
            <circle cx="26" cy="28" r="3.5" fill="#0f172a"/><circle cx="42" cy="28" r="3.5" fill="#0f172a"/>
            <path d="M22 38 q10 8 20 0" stroke="#16a34a" stroke-width="4" fill="none" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="rc-titlewrap">
          <div id="rcTitle" class="rc-title">Your Report Card</div>
          <div id="rcMeta" class="rc-meta">‚Äî</div>
        </div>
        <div id="rcGrade" class="rc-grade">A</div>
      </div>
      <button class="xbtn" id="closeReport" type="button">Close</button>
    </div>
    <div class="rc-head"><div>Category</div><div>Details</div><div>Grade</div></div>
    <div class="rc-rows" id="rcRows"></div>
    <div class="rc-actions" style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px; flex-wrap:wrap">
      <button class="btn" id="printReport" type="button">Save as PDF</button>
      <button class="btn primary" id="calcAgain" type="button">Recalculate</button>
    </div>
  </div>
</div>

<!-- Subscribe -->
<section class="container" style="max-width:900px; margin:30px auto; padding:18px;background:var(--panel); border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow)">
  <h3 style="margin:0 0 6px; font-size:20px">Get simple money tips & updates</h3>
  <p style="margin:6px 0 12px; color:#9fb0c7">No spam, unsubscribe anytime.</p>
  <form id="subForm" style="display:flex; gap:10px; flex-wrap:wrap" action="https://formspree.io/f/xvgblayy" method="POST">
    <input type="email" name="email" id="subEmail" placeholder="you@example.com" required style="flex:1 1 280px; padding:12px; border-radius:12px; border:1px solid var(--line); background:#0b1226; color:#e2e8f0;">
    <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off" />
    <input type="hidden" name="_subject" value="New Grade My Finance subscriber" />
    <button type="submit" class="btn primary">Subscribe</button>
  </form>
</section>

<div style="position:fixed; left:50%; bottom:22px; transform:translateX(-50%); background:#0b1226; color:#e2e8f0; border:1px solid var(--line); border-radius:12px; padding:10px 14px; box-shadow:var(--shadow); display:none; z-index:120" id="toast" role="status" aria-live="polite">Thanks! Check your inbox for a confirmation.</div>

<!-- Sticky CTA -->
<div class="mobile-cta" id="mobileCta">
  <button id="gradeBtnSticky" class="btn primary" type="button">Get My Report Card</button>
</div>

<footer>
  <div class="fwrap">
    <div class="fcontact"><span class="pill">Contact</span> <a class="pill" href="mailto:grademyfinance@gmail.com">grademyfinance@gmail.com</a></div>
    <div class="fnote">¬© 2025 Grade My Finance ‚Äî educational use only (not financial advice).</div>
  </div>
</footer>

<script>
(function(){
  function $(id){ return document.getElementById(id); }
  function qs(sel){ return document.querySelector(sel); }

  // Theme & currency
  var root=document.documentElement;
  var savedTheme=localStorage.getItem('gmf_theme'); if(savedTheme==='light') root.dataset.theme='light';
  var themeBtn=$('themeToggle'); if(themeBtn){ themeBtn.addEventListener('click', function(){ var next=root.dataset.theme==='light'?'':'light'; root.dataset.theme=next; localStorage.setItem('gmf_theme', next||'dark'); }); }
  var CURRENCY=localStorage.getItem('gmf_curr')||'USD';
  var curSel=$('currencySel'); if(curSel){ curSel.value=CURRENCY; curSel.addEventListener('change', function(){ CURRENCY=curSel.value; localStorage.setItem('gmf_curr',CURRENCY); updateHints(); }); }
  function money(n){ return isFinite(n)? new Intl.NumberFormat(undefined,{style:'currency',currency:CURRENCY,maximumFractionDigits:0}).format(Math.round(n)) : '‚Äî'; }

  // Inputs map
  var ids=['age','income','expenses','home','retire','brokerage','car','hsa','cash','mortgage','student','auto','cc'];
  var els={}; ids.forEach(function(id){ els[id]=$(id); });
  function val(id){ var e=els[id]; return e && e.value!=='' ? Number(e.value) : 0; }

  // Input hygiene
  ids.forEach(function(id){
    var e=els[id]; if(!e) return;
    e.addEventListener('input', function(){ e.value=e.value.replace(/[^\d.-]/g,''); });
    e.addEventListener('blur', function(){ if(e.value!=='') e.value=String(Math.round(+e.value)); updateHints(); });
  });

  // Housing mode
  function setHousing(mode){
    var show = (mode==='owner');
    var hc=qs('#homeCard'), mc=qs('#mortCard');
    if(hc) hc.style.display = show ? '' : 'none';
    if(mc) mc.style.display = show ? '' : 'none';
    if(!show){ if(els.home) els.home.value=0; if(els.mortgage) els.mortgage.value=0; }
    localStorage.setItem('gmf_housing',mode); updateHints();
  }
  var savedMode=localStorage.getItem('gmf_housing')||'owner';
  setHousing(savedMode);
  var modeOwner=$('modeOwner'), modeRenter=$('modeRenter');
  if(modeOwner) modeOwner.addEventListener('click', function(){ setHousing('owner'); });
  if(modeRenter) modeRenter.addEventListener('click', function(){ setHousing('renter'); });

  // Hints & values
  function values(){
    var v={}; ids.forEach(function(id){ v[id]=val(id); });
    v.assets=v.home+v.retire+v.brokerage+v.car+v.hsa+v.cash;
    v.liabs=v.mortgage+v.student+v.auto+v.cc;
    v.net=v.assets-v.liabs;
    v.annualIncome=v.income*12; v.annualSpend=v.expenses*12;
    v.baseline=Math.max(v.annualSpend, 30000);
    var denomSav=Math.max(v.income, v.expenses, 2000);
    v.saveRate=denomSav>0 ? Math.max(0, v.income - v.expenses)/denomSav : 0;
    v.efMonths=v.expenses>0 ? v.cash/v.expenses : 0;
    v.nonMortDebt=v.student+v.auto+v.cc;
    v.dtiNonMort = v.baseline>0 ? v.nonMortDebt/v.baseline : 1;
    v.nwTargetMultiple = targetNW(v.age||30);
    v.nwTargetAmount = v.nwTargetMultiple * v.baseline;
    v.nwProgress = v.nwTargetAmount>0 ? v.net/v.nwTargetAmount : 0;
    var ratio = v.annualIncome / 70000;
    v.incomeScore = clamp(0.5 + 0.5*Math.tanh((ratio-1)*1.2), 0, 1);
    v.incomeLetter = incomeLetterFromRatio(ratio);
    return v;
  }
  function updateHints(){ var v=values(); var ah=$('assetsHint'), lh=$('liabHint'); if(ah) ah.textContent='Total Assets: '+money(v.assets); if(lh) lh.textContent='Total Liabilities: '+money(v.liabs); }
  updateHints();

  // Curves & helpers
  var NW_CURVE=[[25,0.2],[30,0.5],[35,1.0],[40,1.5],[45,2.5],[50,3.5],[55,5.0],[60,6.5]];
  function targetNW(age){
    if(age<=NW_CURVE[0][0]) return NW_CURVE[0][1];
    if(age>=NW_CURVE[NW_CURVE.length-1][0]) return NW_CURVE[NW_CURVE.length-1][1];
    for(var i=1;i<NW_CURVE.length;i++){
      var a0=NW_CURVE[i-1][0], t0=NW_CURVE[i-1][1], a1=NW_CURVE[i][0], t1=NW_CURVE[i][1];
      if(age<=a1){ var t=(age-a0)/(a1-a0); return t0+(t1-t0)*t; }
    }
    return NW_CURVE[NW_CURVE.length-1][1];
  }
  function clamp(x,a,b){ return Math.max(a,Math.min(b,x)); }
  function map01(x,a,b){ return clamp((x-a)/(b-a),0,1); }
  function overallLetter(s){ return s>=97?'A+':s>=93?'A':s>=90?'A-':s>=87?'B+':s>=83?'B':s>=80?'B-':s>=77?'C+':s>=73?'C':s>=70?'C-':s>=67?'D+':s>=63?'D':s>=60?'D-':'F'; }
  function letterFrom01(s){ return overallLetter(Math.round(s*100)); }
  function incomeLetterFromRatio(r){ return r>=2.2?'A+': r>=1.8?'A': r>=1.5?'A-': r>=1.3?'B+': r>=1.15?'B': r>=1.0?'B-': r>=0.9?'C+': r>=0.8?'C': r>=0.7?'C-': r>=0.6?'D': 'F'; }
  function badgeClass(l){ return (['A+','A','A-','B+'].indexOf(l)>-1)?'badge good':((['B','B-','C+','C','C-'].indexOf(l)>-1)?'badge mid':'badge bad'); }

  function categoryScores(v){
    var sSave = map01(v.saveRate, 0, 0.25);
    var sEF   = map01(v.efMonths, 0, 6);
    var sDebt = clamp(1 - v.dtiNonMort/0.50, 0, 1);
    var sAgeNW = Math.pow(clamp(v.nwProgress, 0, 1.0), 0.85);
    var sInc  = v.incomeScore;
    var weighted = (sSave*0.15 + sEF*0.10 + sDebt*0.05 + sAgeNW*0.65 + sInc*0.05)*100;
    var score = (v.annualSpend>0 && v.net >= 25*Math.max(v.annualSpend, 30000)) ? Math.max(weighted,94) : weighted;
    return {
      components: [
        {key:'Savings rate', sub:'Toward 25% target', val:Math.round(v.saveRate*100)+'% of take-home',
         letter:letterFrom01(sSave),
         tip: v.saveRate<0.25 ? 'Aim for 25%. You‚Äôre short ~'+money(Math.max(0,(v.income*0.25)-(v.income-v.expenses)))+'/mo.' : 'Great job‚Äîstay consistent.'},
        {key:'Emergency fund', sub:'Goal 6 months', val:v.efMonths.toFixed(1)+' months',
         letter:letterFrom01(sEF),
         tip: v.efMonths<6 ? 'Save ~'+money(Math.round((v.expenses*6 - v.cash)/6))+'/mo to reach 6 months.' : 'Solid cushion ‚Äî keep it liquid.'},
        {key:'Debt load (non-mort.)', sub:'Lower is better', val:Math.round(v.dtiNonMort*100)+'% of baseline',
         letter:letterFrom01(sDebt),
         tip: v.dtiNonMort>0.25 ? 'Add '+money(Math.round(v.baseline*0.05))+'/mo to highest APR first.' : 'Healthy debt level.'},
        {key:'Age-based net worth', sub:'Target '+v.nwTargetMultiple.toFixed(2)+'√ó baseline', val:Math.round(v.nwProgress*100)+'% of age target',
         letter:letterFrom01(sAgeNW),
         tip: v.nwProgress<1 ? 'Gap ~'+money(Math.max(0, v.nwTargetAmount - v.net))+'. Invest steadily.' : 'You‚Äôre ahead ‚Äî nice!'},
        {key:'Income strength', sub:'vs median', val:money(v.annualIncome)+'/yr',
         letter:v.incomeLetter,
         tip: (v.annualIncome < 70000*1.15) ? 'Plan skill/raise to reach '+money(Math.round(70000*1.15))+'+.' : 'Automate investing + match.'}
      ],
      overall: { score: Math.round(score*10)/10, letter: overallLetter(Math.round(score*10)/10) }
    };
  }

  // Overlay helpers
  var overlay=$('overlay');
  function showOverlay(b){ if(overlay) overlay.classList.toggle('show', !!b); }

  // Report modal
  var modal=$('reportModal'), rcRows=$('rcRows'), rcGrade=$('rcGrade'), rcMeta=$('rcMeta');
  function openReport(v,cats){
    if(!modal) return;
    rcMeta.textContent='Overall '+cats.overall.score.toFixed(1)+'/100 ‚Ä¢ Net worth '+money(v.net)+' ‚Ä¢ Assets '+money(v.assets)+' ‚Ä¢ Liabilities '+money(v.liabs);
    rcGrade.textContent=cats.overall.letter;
    rcGrade.className='rc-grade '+(
      ['A+','A','A-','B+'].indexOf(cats.overall.letter)>-1?'good':
      (['B','B-','C+','C','C-'].indexOf(cats.overall.letter)>-1?'mid':'bad'));
    rcRows.innerHTML='';
    cats.components.forEach(function(c){
      var row=document.createElement('div'); row.className='rc-row';
      row.innerHTML='<div class="rc-cell"><div class="label" title="'+c.sub+'">'+c.key+
        '</div><div class="sub">'+c.sub+'</div></div>'+
        '<div class="rc-cell detail-col"><div class="detail">'+c.val+
        '</div><div class="tip">'+c.tip+'</div></div>'+
        '<div class="rc-cell"><span class="'+badgeClass(c.letter)+'">'+c.letter+'</span></div>';
      rcRows.appendChild(row);
    });
    modal.classList.add('show');
  }
  var closeReport=$('closeReport'); if(closeReport) closeReport.addEventListener('click',function(){ modal.classList.remove('show'); });

  // Grade sequence
  function gradeNow(){
    try{
      showOverlay(true);
      setTimeout(function(){
        var v=values();
        var cats=categoryScores(v);
        showOverlay(false);
        openReport(v,cats);
      }, 300);
    }catch(err){
      showOverlay(false);
      console.error(err);
      alert('Oops ‚Äî something went wrong. Check the console for details.');
    }
  }

  // Button wires
  var gradeBtnTop=$('gradeBtnTop'), gradeBtn=$('gradeBtn'), gradeBtnSticky=$('gradeBtnSticky');
  if(gradeBtnTop) gradeBtnTop.addEventListener('click', gradeNow);
  if(gradeBtn) gradeBtn.addEventListener('click', gradeNow);
  if(gradeBtnSticky) gradeBtnSticky.addEventListener('click', gradeNow);
  var printReport=$('printReport'); if(printReport) printReport.addEventListener('click', function(){ window.print(); });
  var calcAgain=$('calcAgain'); if(calcAgain) calcAgain.addEventListener('click', function(){ modal.classList.remove('show'); });

  // Demo button ‚Äî RANDOMIZED every click
  function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function randomDemo(){
    var isOwner = (localStorage.getItem('gmf_housing')||'owner')==='owner';
    var age = rand(22,60);
    var income = rand(2500,15000);
    var expenses = Math.max(800, Math.floor(income*rand(55,88)/100));
    var retire = rand(2000, 250000);
    var brokerage = rand(0, 120000);
    var car = rand(0, 35000);
    var hsa = rand(0, 8000);
    var cash = rand(0, 30000);
    var student = rand(0, 45000);
    var auto = rand(0, 22000);
    var cc = rand(0, 6000);
    var home=0, mortgage=0;
    if(isOwner){
      home = rand(120000, 900000);
      var ltv = rand(40,90)/100;
      mortgage = Math.floor(home*ltv) - rand(0,20000);
      if(mortgage<0) mortgage=0;
    }
    var d={age:age,income:income,expenses:expenses,home:home,retire:retire,brokerage:brokerage,
      car:car,hsa:hsa,cash:cash,mortgage:mortgage,student:student,auto:auto,cc:cc};
    Object.keys(d).forEach(function(id){ if(els[id]) els[id].value=d[id]; });
    updateHints();
  }
  var demoBtn=$('demoBtn'); if(demoBtn) demoBtn.addEventListener('click', randomDemo);

  // Reset
  var resetBtn=$('resetBtn'); if(resetBtn) resetBtn.addEventListener('click', function(){
    ids.forEach(function(id){ if(els[id]) els[id].value = (id==='age') ? 30 : 0; });
    updateHints();
  });

  // Share link
  function shareLink(){
    var s={}; ids.forEach(function(id){ s[id]=Number(els[id]?els[id].value:0); });
    return location.origin+location.pathname+'#s='+encodeURIComponent(btoa(unescape(encodeURIComponent(JSON.stringify(s)))));
  }
  var copyLink=$('copyLink'); if(copyLink) copyLink.addEventListener('click', function(){
    var url=shareLink(); if(navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(url).then(function(){ alert('Share link copied!'); }).catch(function(){ alert(url); }); } else { alert(url); }
  });

  // Hydrate from shared link
  try{
    var m=location.hash.match(/#s=([^&]+)/);
    if(m){ var obj=JSON.parse(decodeURIComponent(escape(atob(decodeURIComponent(m[1])))));
      Object.keys(obj).forEach(function(id){ if(els[id]) els[id].value=obj[id]; });
      updateHints();
    }
  }catch(e){ /* ignore */ }

  // Subscribe (Formspree)
  var subForm=$('subForm'), subEmail=$('subEmail'), toast=$('toast');
  if(subForm) subForm.addEventListener('submit', function(e){
    e.preventDefault();
    var email=subEmail.value.trim();
    if(!/^\S+@\S+\.\S+$/.test(email)){ alert('Please enter a valid email.'); return; }
    fetch(subForm.action, { method:'POST', headers:{'Accept':'application/json','Content-Type':'application/json'}, body:JSON.stringify({email:email,source:'grademyfinance.com'}) })
      .then(function(res){
        if(res.ok){ toast.textContent='Thanks! Check your inbox for a confirmation.'; toast.style.display='block'; setTimeout(function(){toast.style.display='none'},2800); subEmail.value=''; }
        else if(res.status===404){ alert('Form not found ‚Äî verify your Formspree form ID.'); }
        else{ alert('Signup failed. Please try again later.'); }
      })
      .catch(function(){ alert('Network error. Please try again later.'); });
  });

  // Sticky CTA on mobile
  var mcta=$('mobileCta');
  function onScroll(){ if(!mcta) return; mcta.classList.toggle('on', window.scrollY>300 && window.matchMedia('(max-width: 720px)').matches ); }
  window.addEventListener('scroll', onScroll); onScroll();

})(); // end IIFE
</script>
</body>
</html>


