<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grade My Finance</title>
<meta name="description" content="A playful, educational snapshot of your money health — learn, level up, repeat." />
<style>
  /* ================= THEME ================= */
  :root{
    --bg:#0f172a; --panel:#0b1226; --card:#0b1226;
    --text:#e2e8f0; --muted:#94a3b8; --line:rgba(148,163,184,.22);
    --accent:#22d3ee; --accent2:#a78bfa; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
    --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  .light{
    --bg:#f5faf6; --panel:#ffffff; --card:#ffffff; --text:#0f172a; --muted:#4b5563;
    --line:rgba(15,23,42,.12); --accent:#16a34a; --accent2:#34d399; --shadow:0 10px 30px rgba(15,23,42,.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:1150px;margin:0 auto;padding:14px 16px}

  /* ================= BANNER / NAV ================= */
  .banner{position:sticky;top:0;z-index:20;border-bottom:1px solid var(--line);backdrop-filter:blur(8px)}
  .bar{
    width:100%;border-radius:14px;padding:6px 14px;display:flex;align-items:center;justify-content:space-between;
    background:linear-gradient(90deg, var(--accent), var(--accent2)); box-shadow:var(--shadow)
  }
  .brand{display:flex;align-items:center;gap:14px}
  .brand h1{margin:0;font-size:26px;color:#062c1b;letter-spacing:.3px}
  .tag{margin:0;font-size:12px;color:#062c1bcc}
  .controls{display:flex;gap:8px;align-items:center}
  .pill{border:none;cursor:pointer;font-weight:800;letter-spacing:.2px;padding:10px 14px;border-radius:999px;background:#0b1226;color:#e2e8f0}
  .light .pill{background:#0f172a}
  .nav{display:flex;gap:6px}
  .tab{border:1px solid #ffffff55;background:#ffffff1a;color:#062c1b;padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer}
  .tab.active{background:#ffffff; color:#062c1b}

  /* ================= LAYOUT / INPUTS ================= */
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  .section{font-size:14px;margin:0 0 8px 0;color:var(--muted);font-weight:800}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input, select{
    width:100%;border:1px solid var(--line);border-radius:12px;padding:12px;background:var(--panel);color:var(--text);outline:none
  }
  input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 30%, transparent)}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
  .btn{padding:12px 16px;border-radius:12px;border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));color:var(--text);font-weight:800;cursor:pointer}
  .btn.primary{
    background:linear-gradient(90deg, var(--accent), var(--accent2));border-color:transparent;color:#062c1b;text-shadow:0 1px 0 #ffffff80
  }

  /* ================= RESULT ================= */
  .resultTitle{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .bigGrade{font-size:64px;font-weight:900;line-height:1;letter-spacing:.5px;opacity:0;transform:scale(.7) rotate(-8deg)}
  .bigGrade.show{animation:pop .65s cubic-bezier(.2,.9,.2,1) forwards}
  @keyframes pop{0%{opacity:0;transform:scale(.7) rotate(-8deg)}60%{opacity:1;transform:scale(1.08) rotate(2deg)}100%{opacity:1;transform:scale(1) rotate(0)}}
  .scoreline{font-size:14px;color:var(--muted)}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--line);font-size:12px}
  .progress{height:10px;background:var(--panel);border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .progress>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
  .note{border:1px dashed var(--line);border-radius:14px;padding:12px;background:rgba(255,255,255,.02)}
  .note h4{margin:0 0 6px 0}

  /* ================= OVERLAY + CONFETTI ================= */
  .overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.35);z-index:60}
  .overlay.show{display:grid}
  .box{width:420px;max-width:86vw;background:var(--panel);border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:var(--shadow)}
  .bar{height:12px;border-radius:999px;background:var(--card);border:1px solid var(--line);overflow:hidden}
  .bar>div{height:100%;width:6%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s}

  /* ================= PAGES ================= */
  .page{display:none}
  .page.active{display:block}

  /* ================= SMALL ================= */
  @media (max-width:980px){.grid2{grid-template-columns:1fr}}
</style>
</head>
<body class="dark">
  <!-- ================= HEADER / NAV ================= -->
  <header class="banner">
    <div class="wrap">
      <div class="bar">
        <div class="brand">
          <!-- 4K-Ready SVG Logo -->
          <svg width="72" height="72" viewBox="0 0 160 160" aria-label="Grade My Finance logo" role="img">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="#fff"/>
                <stop offset="1" stop-color="#d1fae5"/>
              </linearGradient>
              <linearGradient id="g2" x1="0" x2="1">
                <stop offset="0" stop-color="#22d3ee"/>
                <stop offset="1" stop-color="#a78bfa"/>
              </linearGradient>
            </defs>
            <!-- Rounded card -->
            <rect x="8" y="8" width="144" height="144" rx="24" fill="url(#g1)" />
            <!-- Monogram G ring -->
            <path d="M80,28a52,52 0 1 0 52,52h-30a22,22 0 1 1-22-22h46A52,52 0 0 0 80,28Z" fill="#065f46" opacity=".22"/>
            <!-- Report card with check -->
            <rect x="92" y="44" width="40" height="52" rx="8" fill="url(#g2)" />
            <path d="M98 68l7 7 17-17" fill="none" stroke="#064e3b" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
            <!-- Dollar spark -->
            <path d="M56 56c10-10 28-6 28 6s-16 10-22 14 0 14 14 12" fill="none" stroke="#16a34a" stroke-width="6" stroke-linecap="round"/>
            <!-- Letter -->
            <text x="30" y="110" font-size="70" font-weight="900" fill="#065f46">G</text>
          </svg>
          <div>
            <h1>Grade My Finance</h1>
            <p class="tag">A playful snapshot of your money health — learn, level-up, repeat.</p>
          </div>
        </div>
        <div class="controls">
          <nav class="nav" id="nav">
            <button class="tab active" data-page="grade">Grade</button>
            <button class="tab" data-page="about">About</button>
            <button class="tab" data-page="goal">Our Goal</button>
            <button class="tab" data-page="faq">FAQ</button>
          </nav>
          <button id="shareBtn" class="pill" title="Copy shareable link">🔗 Share</button>
          <button id="modeBtn" class="pill" aria-label="Toggle light/dark">🌚 Dark</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ================= MAIN: PAGES ================= -->
  <main class="wrap" style="margin-top:18px">
    <!-- ===== Grade Page ===== -->
    <section id="page-grade" class="page active">
      <div class="grid">
        <!-- Inputs -->
        <div class="card" style="grid-column:span 4">
          <div class="section">Monthly Income (after-tax)</div>
          <label>What hits your bank each month</label>
          <input id="income" type="number" value="7500" min="0" />
        </div>
        <div class="card" style="grid-column:span 4">
          <div class="section">Monthly Expenses</div>
          <label>All bills + spending</label>
          <input id="expenses" type="number" value="4000" min="0" />
        </div>
        <div class="card" style="grid-column:span 4">
          <div class="section">Cash Savings</div>
          <label>Checking + savings (HSA is in Assets)</label>
          <input id="cash" type="number" value="25000" min="0" />
        </div>

        <!-- Assets -->
        <div class="card" style="grid-column:span 6">
          <div class="section">Assets 💰</div>
          <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:12px">
            <div style="grid-column:span 6"><label>Home Value</label><input id="home" type="number" value="450000" min="0"></div>
            <div style="grid-column:span 6"><label>Retirement (401k/IRA)</label><input id="retire" type="number" value="72000" min="0"></div>
            <div style="grid-column:span 6"><label>Brokerage/Stocks</label><input id="brokerage" type="number" value="29000" min="0"></div>
            <div style="grid-column:span 6"><label>Car Value</label><input id="car" type="number" value="17000" min="0"></div>
            <div style="grid-column:span 6"><label>HSA (counted here)</label><input id="hsa" type="number" value="1500" min="0"></div>
          </div>
          <div class="hint" id="assetsHint">Total Assets: —</div>
        </div>

        <!-- Liabilities + APR -->
        <div class="card" style="grid-column:span 6">
          <div class="section">Liabilities 🧾 (+ APR)</div>
          <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:12px">
            <div style="grid-column:span 6"><label>Mortgage Balance</label><input id="mortgage" type="number" value="326000" min="0"></div>
            <div style="grid-column:span 6"><label>Mortgage APR %</label><input id="mortgageApr" type="number" value="5.25" step="0.01" min="0"></div>

            <div style="grid-column:span 6"><label>Student Loans</label><input id="student" type="number" value="26000" min="0"></div>
            <div style="grid-column:span 6"><label>Student APR %</label><input id="studentApr" type="number" value="4.9" step="0.01" min="0"></div>

            <div style="grid-column:span 6"><label>Auto Loans</label><input id="auto" type="number" value="13000" min="0"></div>
            <div style="grid-column:span 6"><label>Auto APR %</label><input id="autoApr" type="number" value="3.5" step="0.01" min="0"></div>

            <div style="grid-column:span 6"><label>Credit Cards (balance)</label><input id="cc" type="number" value="23" min="0"></div>
            <div style="grid-column:span 6"><label>Credit Card APR %</label><input id="ccApr" type="number" value="24.99" step="0.01" min="0"></div>
          </div>
          <div class="hint" id="liabHint">Total Liabilities: —</div>
        </div>

        <!-- About + Profiles -->
        <div class="card" style="grid-column:span 8">
          <div class="section">About You</div>
          <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:12px">
            <div style="grid-column:span 2"><label>Age</label><input id="age" type="number" value="29" min="16" max="100"></div>
            <div style="grid-column:span 4"><label>Nickname (clean language only)</label><input id="nick" placeholder="e.g., Money Maverick 😎"></div>
            <div style="grid-column:span 3"><label>Profile name</label><input id="profileName" placeholder="e.g., Me"></div>
            <div style="grid-column:span 3"><label>Saved profiles</label>
              <select id="profileSelect"><option value="">— none —</option></select>
            </div>
          </div>
        </div>

        <div class="card" style="grid-column:span 4;display:flex;align-items:end;justify-content:end">
          <div class="actions">
            <button id="saveBtn" class="btn">Save</button>
            <button id="loadBtn" class="btn">Load</button>
            <button id="resetBtn" class="btn">Reset</button>
            <button id="gradeBtn" class="btn primary">Grade Me 🎉</button>
          </div>
        </div>

        <!-- Result -->
        <div class="card" style="grid-column:span 12">
          <div class="resultTitle">
            <div id="bigGrade" class="bigGrade">—</div>
            <div>
              <div id="scoreLine" class="scoreline">Score: — / 100.0</div>
              <div id="nwLine" class="scoreline">Net worth: —</div>
              <div class="chips" id="chips"></div>
            </div>
          </div>
          <div style="margin:14px 0 8px 0" class="progress"><div id="progressFill"></div></div>
          <div class="grid2">
            <div class="note">
              <h4>What went into your grade 🧠</h4>
              <div id="whyList">Enter numbers and hit “Grade Me.”</div>
            </div>
            <div class="note">
              <h4>How to level up 📈</h4>
              <div id="improveList">Personalized ideas will show up here.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== About Page ===== -->
    <section id="page-about" class="page">
      <div class="card">
        <h2>About Grade My Finance</h2>
        <p>We built GMF to turn personal finance into a quick, encouraging check-in — like a progress report, not a lecture. Plug in a few numbers, get a friendly grade, learn <em>why</em>, and leave with a couple of practical ideas.</p>
        <ul>
          <li>🔍 Transparent scoring you can read and debate</li>
          <li>🌞🌚 Light & Dark mode for comfort</li>
          <li>🎉 Confetti for milestones — because wins should feel fun</li>
          <li>🔗 Shareable links & local profiles (your data stays in your browser)</li>
        </ul>
      </div>
    </section>

    <!-- ===== Goal Page ===== -->
    <section id="page-goal" class="page">
      <div class="card">
        <h2>Our Goal</h2>
        <p>Help 1 million people feel calmer and more confident about money.</p>
        <h3>Roadmap</h3>
        <ol>
          <li>Benchmarks that adapt by age & goals</li>
          <li>“What-if” sliders (extra payments, market returns)</li>
          <li>Private cloud profiles & optional sign-in</li>
          <li>Weekly “nudge” mode with micro-tips</li>
        </ol>
        <p>If you’ve got ideas, tell us! <a href="mailto:hello@grademyfinance.app">hello@grademyfinance.app</a></p>
      </div>
    </section>

    <!-- ===== FAQ Page ===== -->
    <section id="page-faq" class="page">
      <div class="card">
        <h2>FAQ</h2>
        <p><b>Is this financial advice?</b> Nope — it’s educational. Use it to spark a plan and talk with a pro if needed.</p>
        <p><b>Where is my data stored?</b> Locally in your browser (profiles) or inside a share link you choose to copy.</p>
        <p><b>Why did my grade change?</b> Savings rate, emergency fund, debt mix, investing share, and net-worth relative to income all move the needle.</p>
      </div>
    </section>
  </main>

  <!-- Loader -->
  <div id="overlay" class="overlay" aria-live="polite" aria-busy="true">
    <div class="box">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Crunching numbers…</strong><span id="pct" class="scoreline">0%</span>
      </div>
      <div class="bar"><div id="barFill"></div></div>
    </div>
  </div>
  <!-- Confetti -->
  <canvas id="confetti" style="position:fixed;inset:0;pointer-events:none;z-index:70"></canvas>

<script>
/* ================= Utilities & Theme ================= */
const $ = s => document.querySelector(s);
const money  = n => isFinite(n) ? `$${Math.round(n).toLocaleString()}` : '—';
const clamp  = (x,a=0,b=1)=>Math.max(a,Math.min(b,x));
const map01  = (x,a,b)=>clamp((x-a)/(b-a));
const badWords = /(\b(fuck|shit|bitch|asshole|cunt|slut|whore|dick|pussy|retard|nigg|chink|spic)\b)/i;

const modeBtn = $('#modeBtn');
function setMode(light){ document.body.classList.toggle('light', light); modeBtn.textContent = light ? '🌞 Light' : '🌚 Dark'; }
setMode(localStorage.getItem('gmf_mode')==='light');
modeBtn.onclick = ()=>{ const v = !document.body.classList.contains('light'); setMode(v); localStorage.setItem('gmf_mode', v?'light':'dark'); };

/* ================= Simple Tabs (SPA) ================= */
const pages = ['grade','about','goal','faq'];
$('#nav').addEventListener('click', (e)=>{
  if(!e.target.classList.contains('tab')) return;
  const pg = e.target.dataset.page;
  pages.forEach(p=>{
    document.getElementById('page-'+p).classList.toggle('active', p===pg);
    [...document.querySelectorAll('.tab')].forEach(t=> t.classList.toggle('active', t.dataset.page===pg));
  });
  // scroll to top of content
  window.scrollTo({top:0, behavior:'smooth'});
});

/* ================= Inputs & live totals ================= */
const ids = ['income','expenses','cash','home','retire','brokerage','car','hsa','mortgage','student','auto','cc','age','mortgageApr','studentApr','autoApr','ccApr'];
const els = Object.fromEntries(ids.map(id=>[id,$('#'+id)]));
Object.values(els).forEach(el=> el.addEventListener('input', updateHints));
updateHints();

function values(){
  const v = Object.fromEntries(ids.map(id=>[id, Number(els[id].value||0)]));
  v.assets = v.cash + v.home + v.retire + v.brokerage + v.car + v.hsa;
  v.liabs  = v.mortgage + v.student + v.auto + v.cc;
  v.net    = v.assets - v.liabs;
  return v;
}
function updateHints(){
  const v = values();
  $('#assetsHint')?.textContent = `Total Assets: ${money(v.assets)}`;
  $('#liabHint')?.textContent   = `Total Liabilities: ${money(v.liabs)}`;
}

/* ================= Scoring =================
   Friendly calibration:
   - Net-worth multiple vs income: full credit ~3×
   - Savings rate: full credit ~50%
   - Emergency fund: full credit ~6 mo
   - Non-mortgage debt vs assets (lower better)
   - Mortgage LTV (lower better; 50%+ is solid)
   - Invested share of assets (20–60%+)
*/
function scoreModel(v){
  const incY = v.income*12 || 1;
  const leftover = Math.max(0, v.income - v.expenses);
  const saveRate = v.income>0 ? leftover / v.income : 0;
  const efMonths = v.expenses>0 ? v.cash / v.expenses : 0;

  const investable = v.retire + v.brokerage + v.hsa;
  const investShare = v.assets>0 ? investable / v.assets : 0;

  const nwMultiple = v.net / incY;
  const sNW   = map01(nwMultiple, 0, 3);
  const sSave = map01(saveRate, 0, 0.5);
  const sEF   = map01(efMonths, 0, 6);

  const nonMortDebt = v.student + v.auto + v.cc;
  const nonMortRatio = v.assets>0 ? nonMortDebt / v.assets : 1;
  const sNonMort = map01(1-nonMortRatio, 0, 1);

  const ltv = v.home>0 ? v.mortgage / v.home : 1;
  const sLTV = map01(1-ltv, 0, 0.5);

  const sInv  = map01(investShare, 0.20, 0.60);

  const score = 30*sNW + 25*sSave + 15*sEF + 15*sNonMort + 5*sLTV + 10*sInv;

  return { score: Number(score.toFixed(1)), saveRate, efMonths, investShare, nwMultiple, ltv, nonMortRatio };
}

/* ================= Letter grade ================= */
function letter(score){
  if(score>=97) return "A+";
  if(score>=93) return "A";
  if(score>=90) return "A-";
  if(score>=87) return "B+";
  if(score>=83) return "B";
  if(score>=80) return "B-";
  if(score>=77) return "C+";
  if(score>=73) return "C";
  if(score>=70) return "C-";
  if(score>=67) return "D+";
  if(score>=63) return "D";
  if(score>=60) return "D-";
  return "F";
}
function gradeColor(L){
  const map = {'A+':'var(--good)','A':'var(--good)','A-':'var(--good)','B+':'#86efac','B':'#86efac','B-':'#86efac','C+':'var(--warn)','C':'var(--warn)','C-':'var(--warn)','D+':'#f97316','D':'#f97316','D-':'#f97316','F':'var(--bad)'}; 
  return map[L] || 'var(--text)';
}

/* ================= Loader ================= */
let barTimer=null;
function showOverlay(){const o=$('#overlay'),b=$('#barFill'),pct=$('#pct');o.classList.add('show');let p=6;b.style.width=p+'%';pct.textContent='6%';barTimer=setInterval(()=>{p=Math.min(96,p+Math.random()*7);b.style.width=p+'%';pct.textContent=Math.round(p)+'%';},220);}
function hideOverlay(){clearInterval(barTimer);$('#barFill').style.width='100%';$('#pct').textContent='100%';setTimeout(()=>$('#overlay').classList.remove('show'),240);}

/* ================= Why & Improve ================= */
function renderWhy(v,s){
  const chips=[];
  chips.push(`<span class="chip">Savings rate: <b>${(s.saveRate*100).toFixed(0)}%</b></span>`);
  chips.push(`<span class="chip">Emergency fund: <b>${s.efMonths.toFixed(1)} mo</b></span>`);
  chips.push(`<span class="chip">Invested share: <b>${(s.investShare*100).toFixed(0)}%</b></span>`);
  chips.push(`<span class="chip">NW ≈ <b>${s.nwMultiple.toFixed(1)}×</b> yearly income</span>`);
  chips.push(`<span class="chip">Mortgage LTV: <b>${(s.ltv*100).toFixed(0)}%</b></span>`);
  chips.push(`<span class="chip">Non-mortgage debt: <b>${(s.nonMortRatio*100).toFixed(1)}%</b> of assets</span>`);
  $('#chips').innerHTML = chips.join('');

  const bullets=[];
  bullets.push(`• Your net worth is <b>${money(v.net)}</b> (assets ${money(v.assets)} minus liabilities ${money(v.liabs)}).`);
  bullets.push(`• Savings rate is <b>${(s.saveRate*100).toFixed(0)}%</b> — about ${money(Math.max(0, v.income-v.expenses))}/mo kept.`);
  bullets.push(`• Emergency cash covers <b>${s.efMonths.toFixed(1)} months</b> of expenses.`);
  bullets.push(`• Invested share of assets is <b>${(s.investShare*100).toFixed(0)}%</b> (retirement + brokerage + HSA).`);
  bullets.push(`• Mortgage LTV is <b>${(s.ltv*100).toFixed(0)}%</b>.`);
  const nonMortDebt=v.student+v.auto+v.cc;
  bullets.push(`• Non-mortgage debt totals <b>${money(nonMortDebt)}</b> (<b>${(s.nonMortRatio*100).toFixed(1)}%</b> of assets).`);
  $('#whyList').innerHTML = bullets.map(b=>`<div>${b}</div>`).join('');
}
function renderImprove(v,s){
  const ideas=[];
  const debtCost = (v.mortgage*v.mortgageApr + v.student*v.studentApr + v.auto*v.autoApr + v.cc*v.ccApr)/100/12;
  if(s.saveRate < 0.2) ideas.push(`Nudge savings to <b>20%+</b> by auto-moving ~${money(Math.ceil(v.income*0.05))}/mo.`);
  if(s.efMonths < 3) ideas.push(`Grow emergency fund to <b>3–6 months</b> (${money(v.expenses*3)}–${money(v.expenses*6)}).`);
  if(s.investShare < 0.35) ideas.push(`Raise invested share to <b>35–60%+</b> over time (401k/IRA/brokerage/HSA).`);
  if(s.ltv > 0.8) ideas.push(`High mortgage LTV (<b>${(s.ltv*100).toFixed(0)}%</b>): occasional principal prepayments can help.`);
  if(s.nonMortRatio > 0.2) ideas.push(`Prioritize non-mortgage debt (<b>${(s.nonMortRatio*100).toFixed(0)}%</b> of assets) — target <20%.`);
  if(debtCost > v.income*0.1) ideas.push(`Monthly interest drag ≈ <b>${money(debtCost)}</b>; refinance or pay down highest APR first.`);
  if(!ideas.length) ideas.push(`You’re cruising! Automate contributions and review yearly. 🎉`);
  $('#improveList').innerHTML = ideas.map(x=>`<div>• ${x}</div>`).join('');
}

/* ================= Confetti ================= */
const c = $('#confetti'), ctx = c.getContext('2d'); let confetti = [];
function size(){ c.width = innerWidth; c.height = innerHeight; }
addEventListener('resize', size); size();
function burst(){ const n=180; confetti=[]; for(let i=0;i<n;i++){ confetti.push({x:c.width/2,y:80, vx:(Math.random()-0.5)*8, vy:Math.random()*-6-2, r:3+Math.random()*4, a:1, spin:Math.random()*6, hue: Math.random()*360}); } animate(); }
function animate(){ ctx.clearRect(0,0,c.width,c.height); let alive=false; for(const p of confetti){ p.vy+=0.15; p.x+=p.vx; p.y+=p.vy; p.a-=0.006; p.spin+=0.2; if(p.a>0 && p.y<c.height+20){ alive=true; ctx.globalAlpha=Math.max(0,p.a); ctx.fillStyle=`hsl(${p.hue},90%,60%)`; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.spin/10); ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2); ctx.restore(); } } if(alive) requestAnimationFrame(animate); else ctx.clearRect(0,0,c.width,c.height); }

/* ================= Grade flow + Share/Profile ================= */
const bigGrade = $('#bigGrade'), scoreLine = $('#scoreLine'), nwLine = $('#nwLine'), progress = $('#progressFill');
let lastLetter = localStorage.getItem('gmf_lastLetter') || '';

$('#gradeBtn').onclick = async ()=>{
  const nick = $('#nick').value, pname = $('#profileName').value;
  if(badWords.test(nick) || badWords.test(pname)){ alert('Please choose a different nickname/profile name.'); return; }

  bigGrade.classList.remove('show'); showOverlay();
  try{
    await new Promise(r=>setTimeout(r,650));
    const v = values(); const s = scoreModel(v);
    const L = letter(s.score);
    bigGrade.textContent = L; bigGrade.style.color = gradeColor(L);
    requestAnimationFrame(()=>bigGrade.classList.add('show'));

    scoreLine.textContent = `Score: ${s.score.toFixed(1)} / 100.0`;
    nwLine.textContent = `Net worth: ${money(v.net)} • Assets: ${money(v.assets)} • Liabilities: ${money(v.liabs)}`;
    progress.style.width = s.score+'%';

    renderWhy(v,s); renderImprove(v,s);
    if(rank(L) > rank(lastLetter)) burst();
    lastLetter = L; localStorage.setItem('gmf_lastLetter', L);
  } finally { hideOverlay(); }
};
function rank(L){ return ['F','D-','D','D+','C-','C','C+','B-','B','B+','A-','A','A+'].indexOf(L); }

/* Save/Load Profiles (localStorage) */
const saveBtn=$('#saveBtn'), loadBtn=$('#loadBtn'), select=$('#profileSelect');
function loadDropdown(){ select.innerHTML = '<option value="">— none —</option>'; Object.keys(localStorage).filter(k=>k.startsWith('gmf_profile_')).forEach(k=>{ const name=k.replace('gmf_profile_',''); const o=document.createElement('option'); o.value=name; o.textContent=name; select.appendChild(o); }); }
loadDropdown();
saveBtn.onclick = ()=>{
  const name = ($('#profileName').value||'').trim();
  if(!name){ alert('Enter a profile name to save.'); return; }
  if(badWords.test(name)){ alert('Please choose a different profile name.'); return; }
  localStorage.setItem('gmf_profile_'+name, JSON.stringify(readState())); loadDropdown(); alert('Saved!');
};
loadBtn.onclick = ()=>{
  const name = select.value || ($('#profileName').value||'').trim();
  if(!name){ alert('Pick a saved profile.'); return; }
  const raw = localStorage.getItem('gmf_profile_'+name); if(!raw){ alert('Profile not found.'); return; }
  applyState(JSON.parse(raw)); updateHints();
};
function readState(){ const s={}; ids.forEach(id=>s[id]=els[id].value); s.nick=$('#nick').value; return s; }
function applyState(s){ ids.forEach(id=>{ if(id in s) els[id].value=s[id]; }); if('nick' in s) $('#nick').value=s.nick; }

/* Shareable Link */
$('#shareBtn').onclick = ()=>{
  const data = readState();
  const b64 = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
  const url = location.origin + location.pathname + '#s=' + b64;
  navigator.clipboard.writeText(url).then(()=>alert('Shareable link copied!'));
};
(function hydrateFromHash(){
  const m = location.hash.match(/#s=([^&]+)/);
  if(!m) return;
  try{
    const obj = JSON.parse(decodeURIComponent(escape(atob(m[1]))));
    applyState(obj); updateHints();
  }catch(e){ console.warn('Bad share payload'); }
})();

/* Reset */
$('#resetBtn').onclick = ()=>{
  document.querySelectorAll('input[type="number"]').forEach(el=>el.value=0);
  els.age.value = 30; $('#nick').value=''; $('#profileName').value=''; updateHints();
  bigGrade.textContent='—'; bigGrade.classList.remove('show');
  scoreLine.textContent='Score: — / 100.0'; nwLine.textContent='Net worth: —';
  progress.style.width='0%'; $('#chips').innerHTML=''; $('#whyList').textContent=''; $('#improveList').textContent='';
};
</script>
</body>
</html>
